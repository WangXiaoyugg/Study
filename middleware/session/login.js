var express = require('express');var fs = require('fs');var exSession = require('./session');var cookieParser = require('cookie-parser');var app = express();app.use(cookieParser());//默认用户名和密码的数据库var users = {    'root':'admin',    'guest':'123456',};function auth(user,password) {    //users.hasOwnProperty(user) 验证 user 是否存在    return users.hasOwnProperty(user) && users[user] == password;};// 如果用户已经登陆，显示用户的名称和访问次数// 如果用户没有登陆，显示登陆界面app.get('/', (req, res) => {    var session = exSession.getSession(req, res);    if (session.hasLogin) {        session.visitCount++;        res.writeHead(200, {'Content-Type': 'text/html'});        res.write('user= ' + session.user + '<br>');        res.write('visitCount = ' + session.visitCount + '<br>');        res.write('<a href=/logout>logout</a>');        res.end()    } else {        fs.readFile('./login.html', (err, data) => {            res.writeHead(200,{'Content-Type':'text/html'});            res.write(data);            res.end();        })    }});// 路由 /login 验证用户名和密码是否正确app.get('/login', (req, res) => {    var user = req.query.user;    var password = req.query.password;    if(auth(user,password)){        var session = exSession.getSession(req,res);        session.hasLogin = true;        session.user = user;        session.visitCount =1;        res.writeHead(200,{'Content-Type':'text/html'});        res.write('Login OK, <a href=/>Goto Home</a>');        res.end();    }else {        res.writeHead(200,{'Content-Type':'text/html'});        res.write('Login Failed, <a href=/>Goto Home</a>');        res.end();    }});// 路由 /logout 退出登陆，将会话中的用户数据删除app.get('/logout', (req, res) => {    var session = exSession.getSession(req,res);    session.destroy();    res.writeHead(200,{'Content-Type':'text/html'});    res.write('Logout,<a href=/>Goto Home</a>');    res.end();});app.listen(8080);console.log('server is running at localhost:8080');